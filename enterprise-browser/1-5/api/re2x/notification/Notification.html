<h1 id="notificationmodule" class="anchor"><a class="heading-anchor" href="#notificationmodule"><span></span></a>Notification Module</h1>

<p><b>
The Notification Module is used to control the notification objects on the device. There are three types of notification object (LEDs, Beeper and Pager) and a device may have more than one of any object type, though in practise devices will have multiple LEDs and a maximum of one beeper and pager. In order to control the notification objects it is first necessary to query the device to discover which objects are available, this is done through the Enumerate method and EnumNotificationsEvent. The EnumNotificationsEvent will return a unique identifier for each available notification and this will be used to set the notification state. Notifications can be set to either on, off or cycling with the behaviour of 'on' or 'off' notification objects self explanatory; when set to cyclic LEDs will flash for the specified number of times whereas the beeper and pager will only activate once for the specified duration.
</b></p>

<h2 id="syntax" class="anchor"><a class="heading-anchor" href="#syntax"><span></span></a>Syntax</h2>

<table class="re-table"><tbody><tr><th class="tableHeading">notification (Module) &lt;META&gt; Syntax
</th></tr><tr><td class="clsSyntaxCells clsOddRow"><p>&lt;META HTTP-Equiv="Notification" content="[method / parameter]"&gt;</p></td></tr><tr><td class="clsSyntaxCells clsEvenRow"><p>&lt;META HTTP-Equiv="Notification" content="EnumNotificationsEvent:url('[jsFunction | url]')"&gt;</p></td></tr></tbody></table>

<table class="re-table"><tbody><tr><th class="tableHeading">Notification JavaScript Object Syntax:</th></tr><tr><td class="clsSyntaxCells clsOddRow">
By default the JavaScript Object <b>'notification'</b> will exist on the current page and can be used to interact directly with the notification.
</td></tr><tr><td class="clsSyntaxCells clsEvenRow">
To Invoke notification methods via JavaScript use the following syntax: notification.method();
<p>e.g. <b>notification</b>.enumerate();
</p></td></tr><tr><td class="clsSyntaxCells clsOddRow">
To Set notification parameters via JavaScript use the following syntax: notification.parameter = 'value'; remembering to enclose your value in quotes where appropriate.  
<p>e.g. <b>notification</b>.setLEDOnDuration = 'value';
</p></td></tr><tr><td class="clsSyntaxCells clsEvenRow">                        
To Set notification return events via JavaScript use the following syntax: notification.event = Javascript Function;
<p>e.g. <b>notification</b>.enumNotificationsEvent = 'doFunction(%json)';
</p><p>
For more details on the event syntax and parameters see the <a href="/rhoelements/RetrievalEvents">Retrieval Events</a> page.

</p></td></tr><tr><td class="clsSyntaxCells clsOddRow">                            
To set multiple <a href="/rhoelements/EMMLOverview">EMML</a> parameters / events on a single line use the following syntax: notification.setEMML("[Your EMML Tags]");
<p>
e.g. <b>notification</b>.setEMML("setLEDOnDuration:<i>value</i>;enumNotificationsEvent:url('JavaScript:doFunction(%json)');enumerate");                            
</p></td></tr></tbody></table>

<table class="re-table"><tbody><tr><th class="tableHeading">Notification Ruby Object Syntax:</th></tr><tr><td class="clsSyntaxCells clsOddRow">
By default the Ruby Object <b>'Notification'</b> will exist on the current page and can be used to interact directly with the Notification. All Methods, Parameters and Events are the same as Javascript, however, notice <b>'Notification'</b> needs to start with an uppercase letter. Another difference in Ruby is that methods do not end in <b>'()'</b></td></tr><tr><td class="clsSyntaxCells clsEvenRow">
To Invoke Notification methods via Ruby use the following syntax: Notification.method()
<p>e.g. <b>Notification</b>.enumerate</p></td></tr><tr><td class="clsSyntaxCells clsOddRow">
To Set Notification parameters via Ruby use the following syntax: Notification.parameter = 'value' remembering to enclose your value in quotes where appropriate.  
<p>e.g. <b>Notification</b>.setLEDOnDuration = 'value'
</p></td></tr><tr><td class="clsSyntaxCells clsEvenRow">                        
To Set Notification return events via Ruby use the following syntax: Notification.event = url_for(:action =&gt; :event_callback) 
<p>e.g. <b>Notification</b>.enumNotificationsEvent = url_for(:action =&gt; :notification_event_callback)
</p><p>
For more details on the event syntax and parameters see the <a href="/rhoelements/RetrievalEvents#params-object">Retrieval Events</a> page.
</p><p>To access the event parameters in a Ruby callback function, you reference the @params object within the callback function. This object is simply a ruby hash {"parameter1 name" =&gt; "parameter1 value", "parameter2 name" =&gt; "parameter2 value", ...}</p></td></tr><tr><td class="clsSyntaxCells clsOddRow"></td></tr></tbody></table>

<h2 id="methods" class="anchor"><a class="heading-anchor" href="#methods"><span></span></a>Methods</h2>

<p>Items listed in this section indicate methods or, in some cases, indicate parameters which will be retrieved.</p>

<table class="re-table"><colgroup><col width="10%"><col width="68%"><col width="22%"></colgroup><tbody><tr><th class="tableHeading">Name</th><th class="tableHeading">Description</th><th class="tableHeading">Default Value</th></tr><tr><td class="clsSyntaxCells clsOddRow"><b>enumerate</b></td><td class="clsSyntaxCells clsOddRow">Immediately triggers an EnumNotificationsEvent containing the notification objects available on the current device</td><td class="clsSyntaxCells clsOddRow">N/A</td></tr></tbody></table>

<h2 id="parameters" class="anchor"><a class="heading-anchor" href="#parameters"><span></span></a>Parameters</h2>

<p>Items listed in this section indicate parameters, or attributes which can be set.</p>

<table class="re-table"><colgroup><col width="20%"><col width="20%"><col width="38%"><col width="22%"></colgroup><tbody><tr><th class="tableHeading">Name</th><th class="tableHeading">Possible Values</th><th class="tableHeading">Description</th><th class="tableHeading">Default Value</th></tr><tr><td class="clsSyntaxCells clsOddRow"><b>setLEDOnDuration:[Value]
</b></td><td class="clsSyntaxCells clsOddRow">Milliseconds</td><td class="clsSyntaxCells clsOddRow">Subsequent calls to cycle LED notifications will cause them to remain on for the specified number of milliseconds per cycle.  This parameter has no effect if the LED State is set to 'On' or 'Off'</td><td class="clsSyntaxCells clsOddRow">1000</td></tr><tr><td class="clsSyntaxCells clsEvenRow"><b>setLEDOffDuration:[Value]
</b></td><td class="clsSyntaxCells clsEvenRow">Milliseconds</td><td class="clsSyntaxCells clsEvenRow">Subsequent calls to cycle LED notifications will cause them to remain off for the specified number of milliseconds per cycle.  This parameter has no effect if the LED State is set to 'On' or 'Off'</td><td class="clsSyntaxCells clsEvenRow">1000</td></tr><tr><td class="clsSyntaxCells clsOddRow"><b>setLEDNumberOfCycles:[Value]
</b></td><td class="clsSyntaxCells clsOddRow">Positive Number</td><td class="clsSyntaxCells clsOddRow">Subsequent calls to cycle LED notifications will cause them to switch between on and off the specified number of times.</td><td class="clsSyntaxCells clsOddRow">1</td></tr><tr><td class="clsSyntaxCells clsEvenRow"><b>setBeeperFrequency:[Value]
</b></td><td class="clsSyntaxCells clsEvenRow">Frequency in Hertz</td><td class="clsSyntaxCells clsEvenRow">When the beeper next sounds it will do so at the specified number of Hertz, provided this is supported by the hardware.  This parameter has an effect for both StateOn and StateCycle.</td><td class="clsSyntaxCells clsEvenRow">2000</td></tr><tr><td class="clsSyntaxCells clsOddRow"><b>setBeeperVolume:[Value]
</b></td><td class="clsSyntaxCells clsOddRow">Number greater than 0.  The maximum value is platform dependant. On Android platform, the range of setBeeperVolume is between 0 to 3. Here, 0 represents the minimum volume and 3 represents the maximum volume. The setBeeperVolume is set to Default value, if the value set for setBeeperVolume is less than 0 or greater than 3. User need to ensure that the device volume is not muted.</td><td class="clsSyntaxCells clsOddRow">When the beeper next sounds it will do so at the specified volume.  0 represents minimum volume, the decibels each volume level represents is device dependant</td><td class="clsSyntaxCells clsOddRow">0 For windows, 1 For Android</td></tr><tr><td class="clsSyntaxCells clsEvenRow"><b>setBeeperDuration:[Value]
</b></td><td class="clsSyntaxCells clsEvenRow">Milliseconds</td><td class="clsSyntaxCells clsEvenRow">When the beeper is next instructed to cycle it will sound for the specified number of milliseconds</td><td class="clsSyntaxCells clsEvenRow">1000</td></tr><tr><td class="clsSyntaxCells clsOddRow"><b>setVibrateDuration:[Value]
</b></td><td class="clsSyntaxCells clsOddRow">Milliseconds</td><td class="clsSyntaxCells clsOddRow">When the pager is next instructed to cycle it will vibrate the device for the specified number of milliseconds</td><td class="clsSyntaxCells clsOddRow">1000</td></tr><tr><td class="clsSyntaxCells clsEvenRow"><b>stateOn:[Value]
</b></td><td class="clsSyntaxCells clsEvenRow">The index of the notification, obtained via the EnumNotificationsEvent</td><td class="clsSyntaxCells clsEvenRow">Turns the specified notification object on.  This will either light an LED, sound the beeper or vibrate the device depending on the type of the notification. Please note that some platforms may not allow you to continuously vibrate the pager to conserve battery. </td><td class="clsSyntaxCells clsEvenRow">Device Specific</td></tr><tr><td class="clsSyntaxCells clsOddRow"><b>stateOff:[Value]
</b></td><td class="clsSyntaxCells clsOddRow">The index of the notification, obtained via the EnumNotificationsEvent</td><td class="clsSyntaxCells clsOddRow">Turns the specified notification object off.  This will either extinguish an LED, silence the beeper or stop the device from vibrating</td><td class="clsSyntaxCells clsOddRow">Device Specific</td></tr><tr><td class="clsSyntaxCells clsEvenRow"><b>stateCycle:[Value]
</b></td><td class="clsSyntaxCells clsEvenRow">The index of the notification, obtained via the EnumNotificationsEvent</td><td class="clsSyntaxCells clsEvenRow">Cycles the specified notification object.  LEDs will alternate between on and off for the specified number of cycles.  The beeper and pager will be invoked once for the specified number of milliseconds.</td><td class="clsSyntaxCells clsEvenRow">Device Specific</td></tr></tbody></table>

<table class="re-table"><colgroup><col width="78%"><col width="8%"><col width="1%"><col width="5%"><col width="1%"><col width="5%"><col width="2%"></colgroup></table>    

<h2 id="events" class="anchor"><a class="heading-anchor" href="#events"><span></span></a>Events</h2>

<p>Values are returned to the caller in RhoElements via Events.  Most modules contain events and those returned from this module are given below along with the event parameters.  Events can cause a navigation to a new URL or a Javascript function on the page to be invoked.  Each event will in most cases have a number of parameters associated with it which will either be strings or javascript arrays.  Event parameters can be accessed either directly or via JSON objects.</p>

<p><br></p>

<h3 id="enumnotificationsevent" class="anchor"><a class="heading-anchor" href="#enumnotificationsevent"><span></span></a>enumNotificationsEvent</h3>

<p>The EnumNotificationsEvent is triggered in response to calling the 'Enumerate' method and is used to obtain the notifications available on the device and their associated identifiers. There is a single return value for this event which is a two dimensional array, with one dimension listing the available notifications and the other dimension listing the attributes for each notification object</p>

<table class="re-table"><colgroup><col width="3%"><col width="20%"><col width="77%"></colgroup><tbody><tr><th class="tableHeading">ID</th><th class="tableHeading">Name</th><th class="tableHeading">Description</th></tr><tr><td style="text-align:left;" class="clsSyntaxCells clsOddRow">1</td><td style="text-align:left;" class="clsSyntaxCells clsOddRow"><b>notificationsArray (notificationIndex, notificationType, notificationName)</b></td><td style="text-align:left;" class="clsSyntaxCells clsOddRow">2 Dimensional array of notifications, see remarks</td></tr></tbody></table>

<h2 id="multiinstance" class="anchor"><a class="heading-anchor" href="#multiinstance"><span></span></a>Multi Instance</h2>

<p>When multiple RhoElememts applications are running the following considerations should be made: Only the application with Focus will have the ability to enable/disable notifications. When an application is sent to background if there are any notifications in progress (vibrator, beeper etc.) they would be stopped.</p>

<h2 id="remarks" class="anchor"><a class="heading-anchor" href="#remarks"><span></span></a>Remarks</h2>

<h3 id="nonotificationobjects" class="anchor"><a class="heading-anchor" href="#nonotificationobjects"><span></span></a>No Notification Objects</h3>

<p>If the device has no notification objects the array returned by EnumNotificationsEvent will be empty</p>

<h3 id="notificationstate" class="anchor"><a class="heading-anchor" href="#notificationstate"><span></span></a>Notification State</h3>

<p>If RhoElements is exited after applying notifications, the settings will not revert.</p>

<h3 id="enumnotificationseventarrayformat" class="anchor"><a class="heading-anchor" href="#enumnotificationseventarrayformat"><span></span></a>EnumNotificationsEvent Array Format</h3>

<p>There is a single return value for this event which is a two dimensional array with the format below:</p>

<pre class="prettyprint">

(
   (                      //  Array for Notification 1
      notificationIndex,  //  Unique Identifier for each notification.
      notificationType,   //  Type of the notification.  '0' Indicates an LED; '1' indicates a Beeper and '2' indicates a pager
      notificationName    //  Human readable name of the notification, e.g. "Green LED"
   )
   (                      //  Array for Notification 2
      notificationIndex,
      notificationType,
      notificationName
   )
)
</pre>

<h2 id="requirements" class="anchor"><a class="heading-anchor" href="#requirements"><span></span></a>Requirements</h2>

<table class="re-table"><tbody><tr><th class="tableHeading">RhoElements Version</th><td class="clsSyntaxCell clsEvenRow">1.0.0 or above
</td></tr><tr><th class="tableHeading">Supported Devices</th><td class="clsSyntaxCell clsOddRow">All supported devices.</td></tr><tr><th class="tableHeading">Minimum Requirements</th><td class="clsSyntaxCell clsOddRow">None.</td></tr><tr><th class="tableHeading">Persistence</th><td class="clsSyntaxCell clsEvenRow">Partially Persistent - Changes to this module will persist when navigating to a new page with the exception of the EnumNotificationsEvent which is page specific.</td></tr></tbody></table>

<h2 id="htmljavascriptexamples" class="anchor"><a class="heading-anchor" href="#htmljavascriptexamples"><span></span></a>HTML/Javascript Examples</h2>

<p>The following example stores the available notifications in a javascript array and displays them to the user in an HTML table. Note that a 2 dimensional array is returned in the EnumNotificationsEvent.</p>

<pre class="prettyprint"><code>&lt;HTML&gt;
&lt;HEAD&gt;
&lt;META HTTP-Equiv="Notification" content="EnumNotificationsEvent:url('javascript:setupNtfyArr(%s)');"&gt;
&lt;/HEAD&gt;
&lt;script&gt;
   var ntfyArr = new Array();
   var notType = new Array('LED', 'BEEPER', 'PAGER');
   var NTFY_INDEX = 0;
   var NTFY_TYPE = 1;
   var NTFY_NAME = 2;

   function setupNtfyArr(notArr)
   {
     ntfyArr = notArr;
     var html = "";

     for(i=0; i&lt;ntfyArr.length; i++)
     {
       html += '' + ntfyArr[i][NTFY_INDEX] + ', '
            + notType[ntfyArr[i][NTFY_TYPE]] + ''
            + ntfyArr[i][NTFY_NAME] + '';
     }

     html += "";
     htmDiv.innerHTML = html;
   }

   function onListNotifications()
   {
      notification.enumerate();
   }
&lt;/script&gt;
   &lt;BODY&gt;
      &lt;div id="htmDiv"&gt;
      &lt;INPUT TYPE="button" VALUE="List Notification Objects" ONCLICK="onListNotifications();"&gt;
      &lt;/div&gt;
   &lt;/BODY&gt;
&lt;/HTML&gt;
</code></pre>

<p>The following function takes a notification index and a notification type. Depending on the type of notification it invokes it appropriately. The index and type of each notification can be obtained via the EnumNotificationsEvent as demonstrated in the previous example</p>

<pre class="prettyprint"><code>&lt;script&gt;
   function annoyUser(index, type)
   {
     if (type == 0)
     {
       //  If the Type of Notification is an LED flash it 10 times, on for 1 second off for 1 second.
       notification.setLEDOnDuration = 1000;
       notification.setLEDOffDuration = 1000;
       notification.setLEDNumberOfCycles = 10;
       //  Flash the LED
       notification.stateCycle = index;
     }
     else if (type == 1)
     {
       //  If the Type of the Notification is a Beeper emit a continuous high pitch tone at maximum volume
       notification.setBeeperFrequency = 8000;
       notification.setBeeperVolume = 3;
       //  Start the Beeper
       notification.stateOn = index;
     }
     else if (type == 2)
     {
       //  If the type of the notification is a Pager then vibrate the device for 15 seconds
       notification.setVibrateDuration = 15000;
       notification.stateCycle = index);
     }
   }
&lt;/script&gt;
</code></pre>

<h2 id="rubyexamples" class="anchor"><a class="heading-anchor" href="#rubyexamples"><span></span></a>Ruby Examples</h2>

<p>The following example enumerates all the available notifications on a device and displays them in a div on an HTML page: </p>

<pre class="prettyprint"><code>def enumNotificationsEventListener
    devices = @params['notificationsArray']
    counter = 0
    data = "Notification devices present: &lt;BR&gt;"
    if devices
        devices.each{               
            data += "Notification Index: " + devices[counter]['notificationIndex'].to_s() + "&lt;BR&gt;"
            data += "Notification Type: " + devices[counter]['notificationType'].to_s() + "&lt;BR&gt;"
            data += "Notification Name: " + devices[counter]['notificationName'] + "&lt;BR&gt; &lt;HR&gt;"
            counter += 1
        }
    end
    WebView.execute_js("setFieldValue('"+data+"')")
end
</code></pre>

<p>To call the this function from HTML, use the following code: </p>

<pre class="prettyprint"><code>&lt;li onclick="enumNotificationObjects(); "&gt;List available notification objects&lt;/li&gt;
</code></pre>

<p>Where 'enumNotificationObjects()' is a JavaScript function which looks like: </p>

<pre class="prettyprint"><code>function enumNotificationObjects() {
    $.get('/app/NotificationModule/enumerate', { });
    return false;
}
</code></pre>

<p>The 'enumerate' is a Ruby function that attaches the 'enumNotificationEventListener' to the enumeration event and makes a call to enumerate all available notifications</p>

<pre class="prettyprint"><code>def enumerate
    Notification.enumNotificationsEvent = url_for(:action =&gt; :enumNotificationsEventListener)
    Notification.enumerate
end
</code></pre>

<p>The following example tests notifications based on the parameters recieved. The 'index' and the 'type' are picked from the result of the enumeration function described above. </p>

<pre class="prettyprint"><code>def annoyUser
    index = @params['index']
    type = @params['type']

    if type == 0
        #If the Type of Notification is an LED flash it 10 times, on for 1 second off for 1 second.
        Notification.setLEDOnDuration = 1000;
        Notification.setLEDOffDuration = 1000;
        Notification.setLEDNumberOfCycles = 10;
        #Flash the LED
        Notification.stateCycle = index;
    elsif type == 1
        #If the Type of the Notification is a Beeper emit a continuous high pitch tone at maximum volume for 5 seconds
        Notification.setBeeperFrequency = 5000;
        Notification.setBeeperVolume = 3;
        #Start the Beeper
        Notification.stateOn = index;
    else
        #If the type of the notification is a Pager then vibrate the device for 5 seconds
        Notification.setVibrateDuration = 5000;
        Notification.stateCycle = index;
    end
end
</code></pre>

<p>To call this function from HTML, use one of the following:</p>

<pre class="prettyprint"><code>&lt;li onclick="testLED(); "&gt;Test LED (If available)&lt;/li&gt;
&lt;li onclick="testBeeper(); "&gt;Test Beeper (If available)&lt;/li&gt;
&lt;li onclick="testPager(); "&gt;Test Pager (If available)&lt;/li&gt;
</code></pre>

<p>Where the 'testLED()', 'testBeeper()' and 'testPager()' are JavaScript functions described below: </p>

<pre class="prettyprint"><code>function testLED() {
    $.get('/app/NotificationModule/annoyUser', {index: 2, type: 0});
    return false;
}

function testBeeper() {
    $.get('/app/NotificationModule/annoyUser', {index: 5, type: 1});
    return false;
}

function testPager() {
    $.get('/app/NotificationModule/annoyUser', {index: 6, type: 2});
    return false;
}
</code></pre>